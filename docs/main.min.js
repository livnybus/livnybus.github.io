(function(){var Schedule,init,load,parseTime;window.location.hash="",parseTime=function(str){var _;return _=str.split(":"),60*parseInt(_[0])+parseInt(_[1])},Array.prototype.upperBound=function(value){var l,m,r;for(l=-1,r=this.length;l+1!==r;)m=Math.floor((l+r)/2),parseTime(this[m].time)<=value?l=m:r=m;return r},Schedule=function(){function Schedule(db){var bus;for(bus in db)db[bus].times.sort(function(a,b){return parseTime(a.time)-parseTime(b.time)});this.db=db,this.buses=Object.keys(db),this.buses.sort(function(a,b){return parseInt(a)-parseInt(b)}),this._buses=document.getElementById("buses"),this._schedule=document.getElementById("schedule"),this._msg=document.getElementById("message"),this.listen(),this.showBuses()}return Schedule.prototype.clear=function(){return this._buses.innerHTML="",this._schedule.innerHTML="",this._msg.innerHTML="",this._msg.style.display="none"},Schedule.prototype.showBuses=function(){var bus,i,len,ref,res;for(this.clear(),res="",i=0,len=(ref=this.buses).length;i<len;i++)res+="<a href=#"+(bus=ref[i])+">"+bus+"</a>";return this._buses.innerHTML=res},Schedule.prototype.showMessage=function(text){return this._msg.innerHTML=text,this._msg.style.display="block"},Schedule.prototype.showSchedule=function(name){var arr,bus,el,i,index,now,ref,ref1,res,time;for(this.clear(),bus=this.db[name],this.showMessage("<span class='title'>"+name+"</span>"+bus.msg),res="",time=60*(now=new Date).getUTCHours()+now.getUTCMinutes()+180,(index=(arr=bus.times).upperBound(time))===arr.length&&(index=0),el=i=ref=index,ref1=arr.length;ref<=ref1?i<ref1:ref1<i;el=ref<=ref1?++i:--i)"Перерыв"===arr[el].dest?res+='<td class="pause" colspan="2">Перерыв</td>':res+="<tr><td class='time'>"+arr[el].time+"</td><td class='station'>"+arr[el].dest+"</td></tr>";return this._schedule.innerHTML=res},Schedule.prototype.listen=function(){return window.addEventListener("hashchange",(_this=this,function(){var url;return""===(url=location.hash.slice(1))?_this.showBuses():_this.showSchedule(url)}));var _this},Schedule}(),load=function(url,cb){var xhr;return"fetch"in window?fetch(url).then(function(res){return res.json()}).then(function(data){return cb(null,data)}).catch(function(err){return cb(err)}):((xhr=new XMLHttpRequest).open("GET",url,!0),xhr.onreadystatechange=function(){if(4===this.readyState)return 200!==this.status&&cb(new Error(this.status,this.statusText)),cb(null,JSON.parse(""+this.responseText))},xhr.send())},init=function(){return load("buses.json",function(err,data){if(err)throw err;return window.app=new Schedule(data)})},window.addEventListener("load",init)}).call(this);