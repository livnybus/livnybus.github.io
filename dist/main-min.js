"use strict";function init(){load("dist/buses.json",function(err,data){if(err)throw err;listNames=function(d){var a=[];for(var i in d)a.push(i);return a}(buses=data).sort(function(a,b){return parseInt(a)-parseInt(b)}),render()})}function load(url,cb){if("fetch"in window)fetch(url).then(function(response){return response.json()}).then(function(data){cb(null,data)}).catch(function(error){cb(error)});else{var xhr=new XMLHttpRequest;xhr.open("GET",url,!1),xhr.send(),200!==xhr.status&&cb(new Error(xhr.status+": "+xhr.statusText)),cb(null,JSON.parse(""+xhr.responseText))}}function convert(str){var arr=str.split(":");return 60*parseInt(arr[0])+parseInt(arr[1])}function search(arr,now){for(var m,l=-1,r=arr.length-1;1<r-l;)now<convert(arr[m=Math.round((r+l)/2)])?r=m:l=m;return now>convert(arr[r])?0:r}function render(){for(var el=0;el<listNames.length;el++){var stations=[],d=new Date,now=60*(d.getUTCHours()+3)+d.getUTCMinutes();for(var name in buses[listNames[el]])stations.push({name:name,time:buses[listNames[el]][name][search(buses[listNames[el]][name],now)]});stations.sort(function(a,b){return convert(a.time)-convert(b.time)});for(var i=0;i<stations.length;i++)draw(listNames[el],stations[i].name,stations[i].time)}}function draw(name,dest,time){var text="<tr><td><span>"+name.trim()+"</span></td><td>"+dest.trim()+"</td><td><time>"+time.trim();text+="</time></td></tr>",layout.innerHTML+=text}"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw-min.js",{scope:"./"}).then(function(registration){console.log("Service worker зарегистрирован:",registration)}).catch(function(error){console.log("Ошибка при регистрации service worker-а:",error)}),navigator.serviceWorker.addEventListener("message",function(event){alert(event.data.msg)}));var buses=[],listNames=[],layout=document.getElementById("schedule");setInterval(render,1e4),init();