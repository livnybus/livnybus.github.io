(function(){var s,t,e,r;window.location.hash="",r=function(t){var e;return e=t.split(":"),60*parseInt(e[0])+parseInt(e[1])},Array.prototype.upperBound=function(t){var e,s,n;for(e=-1,n=this.length;e+1!==n;)s=Math.floor((e+n)/2),r(this[s].time)<=t?e=s:n=s;return n},s=function(){function t(t){var e;for(e in t)t[e].times.sort(function(t,e){return r(t.time)-r(e.time)});this.db=t,this.buses=Object.keys(t),this.buses.sort(function(t,e){return parseInt(t)-parseInt(e)}),this._buses=document.getElementById("buses"),this._schedule=document.getElementById("schedule"),this._msg=document.getElementById("message"),this.listen(),this.showBuses()}return t.prototype.clear=function(){return this._buses.innerHTML="",this._schedule.innerHTML="",this._msg.innerHTML="",this._msg.style.display="none"},t.prototype.showBuses=function(){var t,e,s,n,r;for(this.clear(),r="",e=0,s=(n=this.buses).length;e<s;e++)r+="<a href=#"+(t=n[e])+">"+t+"</a>";return this._buses.innerHTML=r},t.prototype.showMessage=function(t){return this._msg.innerHTML=t,this._msg.style.display="block"},t.prototype.showSchedule=function(t){var e,s,n,r,i,o,u,h,a,c;for(this.clear(),s=this.db[t],this.showMessage("<span class='title'>"+t+"</span>"+s.msg),a="",c=60*(o=new Date).getUTCHours()+o.getUTCMinutes()+180,(i=(e=s.times).upperBound(c))===e.length&&(i=0),n=r=u=i,h=e.length;u<=h?r<h:h<r;n=u<=h?++r:--r)"Перерыв"===e[n].dest?a+='<td class="pause" colspan="2">Перерыв</td>':a+="<tr><td class='time'>"+e[n].time+"</td><td class='station'>"+e[n].dest+"</td></tr>";return this._schedule.innerHTML=a},t.prototype.listen=function(){return window.addEventListener("hashchange",(e=this,function(){var t;return""===(t=location.hash.slice(1))?e.showBuses():e.showSchedule(t)}));var e},t}(),e=function(t,e){var s;return"fetch"in window?fetch(t).then(function(t){return t.json()}).then(function(t){return e(null,t)})[String.fromCharCode(99)+"atch"](function(t){return e(t)}):((s=new XMLHttpRequest).open("GET",t,!0),s.onreadystatechange=function(){if(4===this.readyState)return 200!==this.status&&e(new Error(this.status,this.statusText)),e(null,JSON.parse(""+this.responseText))},s.send())},t=function(){return e("buses.json",function(t,e){if(t)throw t;return window.app=new s(e)})},window.addEventListener("load",t)}).call(this);